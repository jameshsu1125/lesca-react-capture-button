"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const F=require("react/jsx-runtime"),S=require("react");function ce(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(a);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(a,i).enumerable})),t.push.apply(t,r)}return t}function D(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ce(Object(t),!0).forEach(function(r){Ue(a,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):ce(Object(t)).forEach(function(r){Object.defineProperty(a,r,Object.getOwnPropertyDescriptor(t,r))})}return a}function Be(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function ue(a,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,ge(r.key),r)}}function Re(a,e,t){return e&&ue(a.prototype,e),t&&ue(a,t),Object.defineProperty(a,"prototype",{writable:!1}),a}function Ue(a,e,t){return e=ge(e),e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function k(){return k=Object.assign?Object.assign.bind():function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(a[r]=t[r])}return a},k.apply(this,arguments)}function Ee(a,e){if(typeof a!="object"||a===null)return a;var t=a[Symbol.toPrimitive];if(t!==void 0){var r=t.call(a,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}function ge(a){var e=Ee(a,"string");return typeof e=="symbol"?e:String(e)}var de={exports:{}};(function(a){typeof window>"u"||(function(e){var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,r=e.Blob&&(function(){try{return!!new Blob}catch{return!1}})(),i=r&&e.Uint8Array&&(function(){try{return new Blob([new Uint8Array(100)]).size===100}catch{return!1}})(),n=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,f=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,c=(r||n)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(l){var s,u,h,p,v,o,b,m,y;if(s=l.match(f),!s)throw new Error("invalid data URI");for(u=s[2]?s[1]:"text/plain"+(s[3]||";charset=US-ASCII"),h=!!s[4],p=l.slice(s[0].length),h?v=atob(p):v=decodeURIComponent(p),o=new ArrayBuffer(v.length),b=new Uint8Array(o),m=0;m<v.length;m+=1)b[m]=v.charCodeAt(m);return r?new Blob([i?b:o],{type:u}):(y=new n,y.append(o),y.getBlob(u))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(l,s,u){var h=this;setTimeout(function(){u&&t.toDataURL&&c?l(c(h.toDataURL(s,u))):l(h.mozGetAsFile("blob",s))})}:t.toDataURL&&c&&(t.msToBlob?t.toBlob=function(l,s,u){var h=this;setTimeout(function(){(s&&s!=="image/png"||u)&&t.toDataURL&&c?l(c(h.toDataURL(s,u))):l(h.msToBlob(s))})}:t.toBlob=function(l,s,u){var h=this;setTimeout(function(){l(c(h.toDataURL(s,u)))})})),a.exports?a.exports=c:e.dataURLtoBlob=c})(window)})(de);var fe=de.exports,Te=function(e){return typeof Blob>"u"?!1:e instanceof Blob||Object.prototype.toString.call(e)==="[object Blob]"},he={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},Oe=typeof window<"u"&&typeof window.document<"u",w=Oe?window:{},L=function(e){return e>0&&e<1/0},Ae=Array.prototype.slice;function X(a){return Array.from?Array.from(a):Ae.call(a)}var Pe=/^image\/.+$/;function G(a){return Pe.test(a)}function je(a){var e=G(a)?a.substr(6):"";return e==="jpeg"&&(e="jpg"),".".concat(e)}var pe=String.fromCharCode;function Ce(a,e,t){var r="",i;for(t+=e,i=e;i<t;i+=1)r+=pe(a.getUint8(i));return r}var Fe=w.btoa;function me(a,e){for(var t=[],r=8192,i=new Uint8Array(a);i.length>0;)t.push(pe.apply(null,X(i.subarray(0,r)))),i=i.subarray(r);return"data:".concat(e,";base64,").concat(Fe(t.join("")))}function De(a){var e=new DataView(a),t;try{var r,i,n;if(e.getUint8(0)===255&&e.getUint8(1)===216)for(var f=e.byteLength,c=2;c+1<f;){if(e.getUint8(c)===255&&e.getUint8(c+1)===225){i=c;break}c+=1}if(i){var l=i+4,s=i+10;if(Ce(e,l,4)==="Exif"){var u=e.getUint16(s);if(r=u===18761,(r||u===19789)&&e.getUint16(s+2,r)===42){var h=e.getUint32(s+4,r);h>=8&&(n=s+h)}}}if(n){var p=e.getUint16(n,r),v,o;for(o=0;o<p;o+=1)if(v=n+o*12+2,e.getUint16(v,r)===274){v+=8,t=e.getUint16(v,r),e.setUint16(v,1,r);break}}}catch{t=1}return t}function ke(a){var e=0,t=1,r=1;switch(a){case 2:t=-1;break;case 3:e=-180;break;case 4:r=-1;break;case 5:e=90,r=-1;break;case 6:e=90;break;case 7:e=90,t=-1;break;case 8:e=-90;break}return{rotate:e,scaleX:t,scaleY:r}}var Le=/\.\d*(?:0|9){12}\d*$/;function ve(a){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return Le.test(a)?Math.round(a*e)/e:a}function C(a){var e=a.aspectRatio,t=a.height,r=a.width,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"none",n=L(r),f=L(t);if(n&&f){var c=t*e;(i==="contain"||i==="none")&&c>r||i==="cover"&&c<r?t=r/e:r=t*e}else n?t=r/e:f&&(r=t*e);return{width:r,height:t}}function Me(a){for(var e=X(new Uint8Array(a)),t=e.length,r=[],i=0;i+3<t;){var n=e[i],f=e[i+1];if(n===255&&f===218)break;if(n===255&&f===216)i+=2;else{var c=e[i+2]*256+e[i+3],l=i+c+2,s=e.slice(i,l);r.push(s),i=l}}return r.reduce(function(u,h){return h[0]===255&&h[1]===225?u.concat(h):u},[])}function Ie(a,e){var t=X(new Uint8Array(a));if(t[2]!==255||t[3]!==224)return a;var r=t[4]*256+t[5],i=[255,216].concat(e,t.slice(4+r));return new Uint8Array(i)}var We=w.ArrayBuffer,z=w.FileReader,U=w.URL||w.webkitURL,He=/\.\w+$/,Se=w.Compressor,ze=(function(){function a(e,t){Be(this,a),this.file=e,this.exif=[],this.image=new Image,this.options=D(D({},he),t),this.aborted=!1,this.result=null,this.init()}return Re(a,[{key:"init",value:function(){var t=this,r=this.file,i=this.options;if(!Te(r)){this.fail(new Error("The first argument must be a File or Blob object."));return}var n=r.type;if(!G(n)){this.fail(new Error("The first argument must be an image File or Blob object."));return}if(!U||!z){this.fail(new Error("The current browser does not support image compression."));return}We||(i.checkOrientation=!1,i.retainExif=!1);var f=n==="image/jpeg",c=f&&i.checkOrientation,l=f&&i.retainExif;if(U&&!c&&!l)this.load({url:U.createObjectURL(r)});else{var s=new z;this.reader=s,s.onload=function(u){var h=u.target,p=h.result,v={},o=1;c&&(o=De(p),o>1&&k(v,ke(o))),l&&(t.exif=Me(p)),c||l?!U||o>1?v.url=me(p,n):v.url=U.createObjectURL(r):v.url=p,t.load(v)},s.onabort=function(){t.fail(new Error("Aborted to read the image with FileReader."))},s.onerror=function(){t.fail(new Error("Failed to read the image with FileReader."))},s.onloadend=function(){t.reader=null},c||l?s.readAsArrayBuffer(r):s.readAsDataURL(r)}}},{key:"load",value:function(t){var r=this,i=this.file,n=this.image;n.onload=function(){r.draw(D(D({},t),{},{naturalWidth:n.naturalWidth,naturalHeight:n.naturalHeight}))},n.onabort=function(){r.fail(new Error("Aborted to load the image."))},n.onerror=function(){r.fail(new Error("Failed to load the image."))},w.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(w.navigator.userAgent)&&(n.crossOrigin="anonymous"),n.alt=i.name,n.src=t.url}},{key:"draw",value:function(t){var r=this,i=t.naturalWidth,n=t.naturalHeight,f=t.rotate,c=f===void 0?0:f,l=t.scaleX,s=l===void 0?1:l,u=t.scaleY,h=u===void 0?1:u,p=this.file,v=this.image,o=this.options,b=document.createElement("canvas"),m=b.getContext("2d"),y=Math.abs(c)%180===90,x=(o.resize==="contain"||o.resize==="cover")&&L(o.width)&&L(o.height),B=Math.max(o.maxWidth,0)||1/0,R=Math.max(o.maxHeight,0)||1/0,O=Math.max(o.minWidth,0)||0,A=Math.max(o.minHeight,0)||0,E=i/n,g=o.width,d=o.height;if(y){var N=[R,B];B=N[0],R=N[1];var Y=[A,O];O=Y[0],A=Y[1];var $=[d,g];g=$[0],d=$[1]}x&&(E=g/d);var V=C({aspectRatio:E,width:B,height:R},"contain");B=V.width,R=V.height;var K=C({aspectRatio:E,width:O,height:A},"cover");if(O=K.width,A=K.height,x){var J=C({aspectRatio:E,width:g,height:d},o.resize);g=J.width,d=J.height}else{var _=C({aspectRatio:E,width:g,height:d}),Q=_.width;g=Q===void 0?i:Q;var Z=_.height;d=Z===void 0?n:Z}g=Math.floor(ve(Math.min(Math.max(g,O),B))),d=Math.floor(ve(Math.min(Math.max(d,A),R)));var be=-g/2,ye=-d/2,we=g,xe=d,M=[];if(x){var ee=0,te=0,I=i,W=n,re=C({aspectRatio:E,width:i,height:n},{contain:"cover",cover:"contain"}[o.resize]);I=re.width,W=re.height,ee=(i-I)/2,te=(n-W)/2,M.push(ee,te,I,W)}if(M.push(be,ye,we,xe),y){var ae=[d,g];g=ae[0],d=ae[1]}b.width=g,b.height=d,G(o.mimeType)||(o.mimeType=p.type);var ie="transparent";p.size>o.convertSize&&o.convertTypes.indexOf(o.mimeType)>=0&&(o.mimeType="image/jpeg");var ne=o.mimeType==="image/jpeg";if(ne&&(ie="#fff"),m.fillStyle=ie,m.fillRect(0,0,g,d),o.beforeDraw&&o.beforeDraw.call(this,m,b),!this.aborted&&(m.save(),m.translate(g/2,d/2),m.rotate(c*Math.PI/180),m.scale(s,h),m.drawImage.apply(m,[v].concat(M)),m.restore(),o.drew&&o.drew.call(this,m,b),!this.aborted)){var oe=function(P){if(!r.aborted){var se=function(j){return r.done({naturalWidth:i,naturalHeight:n,result:j})};if(P&&ne&&o.retainExif&&r.exif&&r.exif.length>0){var le=function(j){return se(fe(me(Ie(j,r.exif),o.mimeType)))};if(P.arrayBuffer)P.arrayBuffer().then(le).catch(function(){r.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{var T=new z;r.reader=T,T.onload=function(H){var j=H.target;le(j.result)},T.onabort=function(){r.fail(new Error("Aborted to read the compressed image with FileReader."))},T.onerror=function(){r.fail(new Error("Failed to read the compressed image with FileReader."))},T.onloadend=function(){r.reader=null},T.readAsArrayBuffer(P)}}else se(P)}};b.toBlob?b.toBlob(oe,o.mimeType,o.quality):oe(fe(b.toDataURL(o.mimeType,o.quality)))}}},{key:"done",value:function(t){var r=t.naturalWidth,i=t.naturalHeight,n=t.result,f=this.file,c=this.image,l=this.options;if(U&&c.src.indexOf("blob:")===0&&U.revokeObjectURL(c.src),n)if(l.strict&&!l.retainExif&&n.size>f.size&&l.mimeType===f.type&&!(l.width>r||l.height>i||l.minWidth>r||l.minHeight>i||l.maxWidth<r||l.maxHeight<i))n=f;else{var s=new Date;n.lastModified=s.getTime(),n.lastModifiedDate=s,n.name=f.name,n.name&&n.type!==f.type&&(n.name=n.name.replace(He,je(n.type)))}else n=f;this.result=n,l.success&&l.success.call(this,n)}},{key:"fail",value:function(t){var r=this.options;if(r.error)r.error.call(this,t);else throw t}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=Se,a}},{key:"setDefaults",value:function(t){k(he,t)}}]),a})(),q=(a=>(a.png="image/png",a.jpg="image/jpeg",a.webp="image/webp",a))(q||{});const Ge=({children:a,maxWidth:e=1024,compress:t=.7,type:r=q.webp,multiple:i=!1,onCapture:n})=>{const f=S.useRef(null),c=()=>{f.current?.click()},l=async s=>{const u=s.target.files;if(u){const h=i?u:{0:u[0]};!i&&u.length>1&&console.warn("[CaptureProvider] multiple is false, but more than one file selected. Only the first file will be processed.");const p=Object.values(h).map(async m=>await Xe(m,{quality:t,mimeType:r,maxWidth:e})),o=(await Promise.all(p)).map(async m=>{const y=URL.createObjectURL(m),x=new Image;x.src=y,await x.decode();const{width:B,height:R}=x;return{width:B,height:R,url:y}}),b=await Promise.all(o);n?.(b),f.current&&(f.current.value="")}};return S.Children.map(a,s=>{const u=s;return F.jsxs(F.Fragment,{children:[typeof s=="string"?F.jsx("div",{onClick:()=>{u.props.onClick?.(),c()},children:s}):S.cloneElement(u,{...u.props,onClick:()=>{u.props.onClick?.(),c()}}),F.jsx("input",{ref:f,style:{display:"none"},type:"file",accept:"image/png,image/jpeg,image/webp;capture=camera",onChange:l,multiple:i})]})})},Xe=(a,e)=>new Promise((t,r)=>{new ze(a,{quality:e.quality,mimeType:e.mimeType,maxWidth:e.maxWidth,success:i=>t(i),error:i=>r(i)})});exports.DOMString=q;exports.default=Ge;
